<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Insights Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <header>
        <h1>üçΩÔ∏è Restaurant Data Analysis</h1>
        <p class="subtitle">Comprehensive insights from global restaurant datasets</p>
    </header>

    <div class="search-container">
        <form action="/" method="GET">
            <input type="text" name="search" placeholder="Search by name, city, or cuisine..." value="{{ query }}">
            <button type="submit">Search</button>
            {% if query %}
            <a href="/" class="clear-btn">Clear</a>
            {% endif %}
        </form>
    </div>

    {% if search_results is not none %}
    <section class="results-container">
        <h2>üîç Search Results (Top 15)</h2>
        {% if search_results %}
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>City</th>
                        <th>Cuisines</th>
                        <th>Rating</th>
                        <th>Price Range</th>
                    </tr>
                </thead>
                <tbody>
                    {% for restaurant in search_results %}
                    <tr>
                        <td><strong>{{ restaurant['Restaurant Name'] }}</strong></td>
                        <td>{{ restaurant['City'] }}</td>
                        <td>{{ restaurant['Cuisines'] }}</td>
                        <td>
                            {% set r_color_class = restaurant['Rating color'].lower().replace(' ', '') %}
                            <span
                                class="rating-badge {{ r_color_class if r_color_class in ['green', 'darkgreen', 'yellow', 'orange', 'white', 'red'] else 'default' }}">
                                {{ restaurant['Aggregate rating'] }} / 5.0
                            </span>
                        </td>
                        <td>
                            <span class="price-range">
                                {{ "üí∞" * restaurant['Price range'] }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-results">No restaurants found for "{{ query }}".</p>
        {% endif %}
    </section>
    {% endif %}

    <main class="dashboard-grid">

        <!-- Key Metrics Cards -->
        <div class="card metric-card">
            <h3>üèôÔ∏è City Analysis</h3>
            <div class="metric-item">
                <span class="label">Most Popular City</span>
                <span class="value">{{ top_city }}</span>
            </div>
            <div class="metric-item">
                <span class="label">Highest Rated City</span>
                <span class="value">{{ best_city }}</span>
            </div>
        </div>

        <div class="card metric-card">
            <h3>‚≠ê Review Insights</h3>
            <div class="metric-item">
                <span class="label">Avg Rating Word Count</span>
                <span class="value">{{ avg_review_length }}</span>
            </div>
            <div class="metric-item">
                <span class="label">Length vs Rating Corr</span>
                <span class="value">{{ review_rating_corr }}</span>
            </div>
        </div>

        <div class="card metric-card">
            <h3>üó≥Ô∏è Voting Trends</h3>
            <div class="metric-item">
                <span class="label">Votes vs Rating Corr</span>
                <span class="value">{{ votes_rating_corr }}</span>
            </div>
            <div class="metric-item">
                <span class="label">Highest Votes</span>
                <span class="value">{{ highest_votes_rest['Votes'] }} ({{ highest_votes_rest['Restaurant Name']
                    }})</span>
            </div>
        </div>

        <!-- Charts/Lists -->
        <div class="card list-card">
            <h3>üî• Top Cuisines</h3>
            <ul class="stats-list">
                {% for cuisine, count in top_cuisines.items() %}
                <li>
                    <span class="stat-name">{{ cuisine }}</span>
                    <span class="stat-value">{{ count }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="card list-card">
            <h3>üí∞ Price Distribution</h3>
            <ul class="stats-list">
                {% for price, count in price_dist.items() %}
                <li>
                    <span class="stat-name">Price Range {{ price }}</span>
                    <span class="stat-value">{{ count }} restaurants</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="card sentiment-card">
            <h3>üé≠ Sentiment Keywords</h3>
            <div class="sentiment-split">
                <div class="pos">
                    <h4>Positive</h4>
                    <div class="tag-cloud">
                        {% for word, count in positive_keywords.items() %}
                        <span class="tag pos-tag" style="opacity: {{ 0.4 + (count / 4000) }}">
                            {{ word }} ({{ count }})
                        </span>
                        {% endfor %}
                    </div>
                </div>
                <div class="neg">
                    <h4>Negative/Average</h4>
                    <div class="tag-cloud">
                        {% for word, count in negative_keywords.items() %}
                        <span class="tag neg-tag" style="opacity: {{ 0.4 + (count / 4000) }}">
                            {{ word }} ({{ count }})
                        </span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <div class="card table-card full-width">
            <h3>üöö Service Availability by Price Range (%)</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Price Range</th>
                            <th>Online Delivery</th>
                            <th>Table Booking</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for price, services in price_service.items() %}
                        <tr>
                            <td><strong>Range {{ price }}</strong></td>
                            <td>{{ services['Has Online delivery'] | round(1) }}%</td>
                            <td>{{ services['Has Table booking'] | round(1) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <footer>
        <p>Built with ‚ù§Ô∏è by Dhanyashree</p>
    </footer>

</body>

</html>